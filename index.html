<div class="rules top">
        🦁:8方向 🦒:前後左右 🐘:斜め4方向 🐗:前のみ
    </div><!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>どうぶつ将棋</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: Arial, sans-serif;
            background-color: #f0fdf4;
            height: 100vh;
            height: 100dvh; /* モバイル対応 */
            display: flex;
            flex-direction: column;
            padding: 4px;
            overflow: hidden;
        }
        
        .player-area {
            display: flex;
            justify-content: center;
            align-items: center;
            padding: 4px;
            flex-shrink: 0;
        }
        
        .player-area.top {
            transform: rotate(180deg);
        }
        
        .player-info {
            text-align: center;
        }
        
        .player-name {
            font-size: 14px;
            font-weight: bold;
            margin-bottom: 4px;
        }
        
        .player-name.active {
            color: #dc2626;
        }
        
        .player-name.inactive {
            color: #6b7280;
        }
        
        .captured-pieces {
            display: flex;
            gap: 4px;
            justify-content: center;
            min-height: 40px;
            padding: 4px;
            border-radius: 8px;
        }
        
        .captured-pieces.player0 {
            background-color: #dbeafe;
        }
        
        .captured-pieces.player1 {
            background-color: #fecaca;
        }
        
        .captured-piece {
            width: 32px;
            height: 32px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 18px;
            cursor: pointer;
            border-radius: 4px;
            border: 1px solid #d1d5db;
        }
        
        .captured-piece:hover {
            background-color: rgba(255, 255, 255, 0.5);
        }
        
        .game-board {
            flex: 1;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        .board {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 4px;
            background-color: #92400e;
            padding: 8px;
            border-radius: 8px;
        }
        
        .square {
            width: 70px;
            height: 70px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 20px;
            cursor: pointer;
            border: 2px solid #d97706;
            border-radius: 4px;
            background-color: #fef3c7;
        }
        
        .square.selected {
            background-color: #fde047;
            border-color: #eab308;
        }
        
        .square.valid-move {
            background-color: #bbf7d0;
            border-color: #16a34a;
        }
        
        .square:hover {
            opacity: 0.8;
        }
        
        .piece {
            display: inline-block;
        }
        
        .piece.rotated {
            transform: rotate(180deg);
        }
        
        .winner-message {
            margin: 4px;
            padding: 4px;
            background-color: #fef3c7;
            border-radius: 8px;
            text-align: center;
            flex-shrink: 0;
        }
        
        .winner-title {
            font-size: 18px;
            font-weight: bold;
            margin-bottom: 8px;
        }
        
        .reset-button {
            margin-top: 4px;
            padding: 8px 12px;
            background-color: #3b82f6;
            color: white;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-size: 14px;
        }
        
        .reset-button:hover {
            background-color: #2563eb;
        }
        
        .rules {
            text-align: center;
            font-size: 12px;
            color: #6b7280;
            padding: 4px;
        }
        
        .rules.top {
            transform: rotate(180deg);
        }
    </style>
</head>
<body>
    <div class="rules">
        🦁:8方向 🦒:前後左右 🐘:斜め4方向 🐗:前のみ
    </div>

    <div class="player-area top">
        <div class="player-info">
            <div class="player-name" id="player1-name">プレイヤー2</div>
            <div class="captured-pieces player1" id="captured1"></div>
        </div>
    </div>

    <div id="winner-message" class="winner-message" style="display: none;">
        <div class="winner-title" id="winner-text"></div>
        <button class="reset-button" onclick="resetGame()">もう一度</button>
    </div>

    <div class="game-board">
        <div class="board" id="board"></div>
    </div>

    <div class="player-area">
        <div class="player-info">
            <div class="captured-pieces player0" id="captured0"></div>
            <div class="player-name" id="player0-name">プレイヤー1</div>
        </div>
    </div>

    <div class="rules">
        🦁:8方向 🦒:前後左右 🐘:斜め4方向 🐗:前のみ
    </div>

    <script>
        const ANIMALS = {
            LION: '🦁',
            GIRAFFE: '🦒',
            ELEPHANT: '🐘',
            BOAR: '🐗'
        };

        // 3×4ボードの初期配置（画像通り）
        const INITIAL_BOARD = [
            ['🦒', '🦁', '🐘'],  // 上段：キリン、ライオン、ゾウ
            [null, '🐗', null], // 2段目：空き、イノシシ、空き
            [null, '🐗', null], // 3段目：空き、イノシシ、空き  
            ['🐘', '🦁', '🦒']  // 下段：ゾウ、ライオン、キリン
        ];

        const INITIAL_OWNERS = [
            [1, 1, 1],           // 上段はプレイヤー2（1）
            [null, 1, null],    // 2段目のイノシシはプレイヤー2
            [null, 0, null],    // 3段目のイノシシはプレイヤー1
            [0, 0, 0]           // 下段はプレイヤー1（0）
        ];

        let board = JSON.parse(JSON.stringify(INITIAL_BOARD));
        let owners = JSON.parse(JSON.stringify(INITIAL_OWNERS));
        let currentPlayer = 0;
        let selectedSquare = null;
        let capturedPieces = [[], []];
        let winner = null;
        let validMoves = [];

        function getMovableSquares(animal, row, col, owner) {
            const moves = [];
            const direction = owner === 0 ? 1 : -1;

            switch (animal) {
                case ANIMALS.LION:
                    for (let dr = -1; dr <= 1; dr++) {
                        for (let dc = -1; dc <= 1; dc++) {
                            if (dr === 0 && dc === 0) continue;
                            const newRow = row + dr;
                            const newCol = col + dc;
                            if (newRow >= 0 && newRow < 4 && newCol >= 0 && newCol < 3) {
                                moves.push([newRow, newCol]);
                            }
                        }
                    }
                    break;

                case ANIMALS.GIRAFFE:
                    [[0, 1], [0, -1], [1, 0], [-1, 0]].forEach(([dr, dc]) => {
                        const newRow = row + dr;
                        const newCol = col + dc;
                        if (newRow >= 0 && newRow < 4 && newCol >= 0 && newCol < 3) {
                            moves.push([newRow, newCol]);
                        }
                    });
                    break;

                case ANIMALS.ELEPHANT:
                    [[1, 1], [1, -1], [-1, 1], [-1, -1]].forEach(([dr, dc]) => {
                        const newRow = row + dr;
                        const newCol = col + dc;
                        if (newRow >= 0 && newRow < 4 && newCol >= 0 && newCol < 3) {
                            moves.push([newRow, newCol]);
                        }
                    });
                    break;

                case ANIMALS.BOAR:
                    const newRow = row - direction;
                    const newCol = col;
                    if (newRow >= 0 && newRow < 4 && newCol >= 0 && newCol < 3) {
                        moves.push([newRow, newCol]);
                    }
                    break;
            }

            // 自分の駒がある場所は除外、相手の駒がある場所は移動可能
            return moves.filter(([r, c]) => owners[r][c] !== owner);
        }

        function handleSquareClick(row, col) {
            if (winner) return;

            if (selectedSquare && selectedSquare.type === 'board') {
                const [selectedRow, selectedCol] = [selectedSquare.row, selectedSquare.col];
                const isValidMove = validMoves.some(([r, c]) => r === row && c === col);

                if (isValidMove) {
                    // 移動先に相手の駒がある場合、持ち駒に加える
                    if (board[row][col] && owners[row][col] !== currentPlayer) {
                        const capturedPiece = board[row][col];
                        capturedPieces[currentPlayer].push(capturedPiece);

                        if (capturedPiece === ANIMALS.LION) {
                            winner = currentPlayer;
                        }
                    }

                    // 駒を移動
                    board[row][col] = board[selectedRow][selectedCol];
                    owners[row][col] = currentPlayer;
                    board[selectedRow][selectedCol] = null;
                    owners[selectedRow][selectedCol] = null;

                    // ターンを変更（勝利が決まっていない場合のみ）
                    if (winner === null) {
                        currentPlayer = 1 - currentPlayer;
                    }
                }

                selectedSquare = null;
                validMoves = [];
                renderGame();
            } else if (selectedSquare && selectedSquare.type === 'captured') {
                // 持ち駒の配置
                if (!board[row][col]) {
                    board[row][col] = selectedSquare.piece;
                    owners[row][col] = currentPlayer;
                    capturedPieces[currentPlayer].splice(selectedSquare.index, 1);
                    currentPlayer = 1 - currentPlayer;
                }

                selectedSquare = null;
                validMoves = [];
                renderGame();
            } else {
                // 駒を選択
                if (board[row][col] && owners[row][col] === currentPlayer) {
                    selectedSquare = { type: 'board', row: row, col: col };
                    validMoves = getMovableSquares(board[row][col], row, col, currentPlayer);
                    renderGame();
                } else {
                    // 選択をクリア
                    selectedSquare = null;
                    validMoves = [];
                    renderGame();
                }
            }
        }

        function handleCapturedPieceClick(piece, index) {
            if (winner) return;

            selectedSquare = { type: 'captured', piece: piece, index: index };

            // 空いているマスを有効な移動先として設定
            validMoves = [];
            for (let row = 0; row < 4; row++) {
                for (let col = 0; col < 3; col++) {
                    if (!board[row][col]) {
                        validMoves.push([row, col]);
                    }
                }
            }
            renderGame();
        }

        function renderGame() {
            renderBoard();
            renderCapturedPieces();
            renderPlayerStatus();
            renderWinnerMessage();
        }

        function renderBoard() {
            const boardElement = document.getElementById('board');
            boardElement.innerHTML = '';

            for (let row = 0; row < 4; row++) {
                for (let col = 0; col < 3; col++) {
                    const square = document.createElement('div');
                    square.className = 'square';
                    square.onclick = () => handleSquareClick(row, col);

                    const isSelected = selectedSquare && 
                        selectedSquare.type === 'board' && 
                        selectedSquare.row === row && 
                        selectedSquare.col === col;
                    
                    const isValidMove = validMoves.some(([r, c]) => r === row && c === col);

                    if (isSelected) {
                        square.classList.add('selected');
                    } else if (isValidMove) {
                        square.classList.add('valid-move');
                    }

                    if (board[row][col]) {
                        const piece = document.createElement('span');
                        piece.className = 'piece';
                        if (owners[row][col] === 1) {
                            piece.classList.add('rotated');
                        }
                        piece.textContent = board[row][col];
                        square.appendChild(piece);
                    }

                    boardElement.appendChild(square);
                }
            }
        }

        function renderCapturedPieces() {
            for (let player = 0; player < 2; player++) {
                const element = document.getElementById(`captured${player}`);
                element.innerHTML = '';

                capturedPieces[player].forEach((piece, index) => {
                    const pieceElement = document.createElement('div');
                    pieceElement.className = 'captured-piece';
                    pieceElement.textContent = piece;
                    if (currentPlayer === player) {
                        pieceElement.onclick = () => handleCapturedPieceClick(piece, index);
                    }
                    element.appendChild(pieceElement);
                });
            }
        }

        function renderPlayerStatus() {
            const player0Name = document.getElementById('player0-name');
            const player1Name = document.getElementById('player1-name');

            player0Name.className = 'player-name ' + (currentPlayer === 0 ? 'active' : 'inactive');
            player1Name.className = 'player-name ' + (currentPlayer === 1 ? 'active' : 'inactive');

            player0Name.textContent = 'プレイヤー1' + (currentPlayer === 0 ? ' ● ターン' : '');
            player1Name.textContent = 'プレイヤー2' + (currentPlayer === 1 ? ' ● ターン' : '');
        }

        function renderWinnerMessage() {
            const winnerMessage = document.getElementById('winner-message');
            const winnerText = document.getElementById('winner-text');

            if (winner !== null) {
                winnerText.textContent = `プレイヤー ${winner + 1} の勝利！🎉`;
                winnerMessage.style.display = 'block';
            } else {
                winnerMessage.style.display = 'none';
            }
        }

        function resetGame() {
            board = JSON.parse(JSON.stringify(INITIAL_BOARD));
            owners = JSON.parse(JSON.stringify(INITIAL_OWNERS));
            currentPlayer = 0;
            selectedSquare = null;
            capturedPieces = [[], []];
            winner = null;
            validMoves = [];
            renderGame();
        }

        // 初期化
        renderGame();
    </script>
</body>
</html>